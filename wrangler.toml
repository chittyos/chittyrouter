name = "chittyrouter"
main = "src/index.js"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]
account_id = "0bc21e3a5a9de1a4cc843be9c3e98121"

[env.staging]
name = "chittyrouter-staging"
main = "src/index.js"
vars = { SERVICE_NAME = "chittyrouter-ai-staging", SERVICE_VERSION = "2.1.0-staging", CHITTYOS_ENVIRONMENT = "staging", VERSION_MANAGEMENT = "enterprise", RANDOMNESS_BEACON = "true" }

[env.staging.ai]
binding = "AI"

[env.production]
name = "chittyrouter-production"
main = "src/index.js"
vars = { SERVICE_NAME = "chittyrouter-ai", SERVICE_VERSION = "2.1.0", CHITTYOS_ENVIRONMENT = "production", VERSION_MANAGEMENT = "enterprise", RANDOMNESS_BEACON = "true" }

[env.production.ai]
binding = "AI"

[[env.production.durable_objects.bindings]]
name = "AI_GATEWAY_STATE"
class_name = "AIGatewayState"
script_name = "chittyrouter-production"

[[env.production.durable_objects.bindings]]
name = "PLATFORM_STATE"
class_name = "ChittyOSPlatformState"
script_name = "chittyrouter-production"

[[env.production.durable_objects.bindings]]
name = "SYNC_STATE"
class_name = "SyncState"
script_name = "chittyrouter-production"

[[env.production.routes]]
pattern = "router.chitty.cc/*"
zone_name = "chitty.cc"

# Default/development configuration
[vars]
SERVICE_NAME = "chittyrouter-ai"
SERVICE_VERSION = "2.1.0"
CHITTYOS_ENVIRONMENT = "production"
VERSION_MANAGEMENT = "enterprise"
RANDOMNESS_BEACON = "true"

[ai]
binding = "AI"

# Durable Objects
[[durable_objects.bindings]]
name = "AI_GATEWAY_STATE"
class_name = "AIGatewayState"
script_name = "chittyrouter"

[[durable_objects.bindings]]
name = "PLATFORM_STATE"
class_name = "ChittyOSPlatformState"
script_name = "chittyrouter"

[[durable_objects.bindings]]
name = "SYNC_STATE"
class_name = "SyncState"
script_name = "chittyrouter"

# Migrations for Durable Objects (using SQLite for free plan)
[[migrations]]
tag = "v1"
new_sqlite_classes = ["AIGatewayState", "ChittyOSPlatformState", "SyncState"]
